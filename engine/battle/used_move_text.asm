
MoveTable:
;	db ROCK_CLIMB
;	db LOW_KICK
;	db WISH
;	db BONE_CLUB
;	db DRAGON_CLAW
;	db PAY_DAY
;	db FIRE_PUNCH
;	db ICE_PUNCH
;	db THUNDERPUNCH
;	db FLAME_CHARGE
;	db X_SCISSOR
;	db SMOG
;	db AIR_SLASH
;	db SWORDS_DANCE 
;	db CUT
;	db GUST
;	db WING_ATTACK
;	db SUCKER_PUNCH
;	db FLY
;	db DAZZLINGLEAM
;	db FLAIL
;	db VINE_WHIP
;	db STOMP
;	db HEX
;	db FLARE_BLITZ
;	db STONE_EDGE
;	db FOCUS_BLAST
;	db BULLET_SEED
;	db HEADBUTT
;	db HORN_ATTACK
;	db FIRE_FANG
;	db ICE_FANG
;	db THUNDER_FANG
;	db TACKLE_SCRATCH_POUND
;	db BODY_SLAM
;	db WOOD_HAMMER
;	db TAKE_DOWN
;	db THRASH
;	db DOUBLE_EDGE
;	db HAIL
;	db POISON_STING
;	db PIN_MISSILE
;	db LEER_TAIL_WHIP
;	db BITE
;	db GROWL
;	db ROAR_WHIRLWIND
;	db SING_HYPNOSIS
;	db SUPERSONIC
;	db WEATHER_BALL
;	db DISABLE
;	db ACID
;	db EMBER
;	db FLAMETHROWER
;	db CALM_MIND
;	db WATER_GUN
;	db HYDRO_PUMP
;	db SURF
;	db ICE_BEAM
;	db BLIZZARD
;	db PSYBEAM
;	db BUBBLE_BEAM
;	db AURORA_BEAM
;	db HYPER_BEAM
;	db PECK
;	db DRILL_PECK
;	db SHADOW_BONE
;	db NIGHT_SLASH
;	db SHOCK_WAVE
;	db SEISMIC_TOSS
;	db STRENGTH
;	db ABSORB
;	db MEGA_DRAIN
;	db LEECH_SEED
;	db COSMIC_POWER
;	db RAZOR_LEAF
;	db SOLAR_BEAM
;	db POISONPOWDER
;	db STUN_SPORE
;	db SLEEP_POWDER
;	db PETAL_DANCE
;	db TAUNT
;	db DRAGON_RAGE
;	db FIRE_SPIN
;	db THUNDERSHOCK
;	db THUNDERBOLT
;	db THUNDER_WAVE
;	db THUNDER
;	db ROCK_THROW
;	db EARTHQUAKE
;	db FAIRY_WIND
;	db DIG
;	db TOXIC
;	db CONFUSION
;	db PSYCHIC_M
;	db DRAGONHAMMER
;	db SIGNAL_BEAM
	db AGILITY_ROCK_POLISH                               ; NEEDS UPDATE
;	db QUICK_ATTACK
;	db RAGE
;	db TELEPORT
;	db NIGHT_SHADE
;	db DRAGON_PULSE
;	db SCREECH
;	db DOUBLE_TEAM
;	db BULLDOZE
;	db ROCK_BLAST
;	db MINIMIZE
;	db SAND_ATTACK_SMOKESCREEN_FLASH
;	db CONFUSE_RAY
;	db AQUA_TAIL
;	db DEFENSE_CURL_HARDEN_WITHDRAW
;	db BARRIER_IRON_DEFENSE_ACID_ARMOR
;	db LIGHT_SCREEN
;	db HAZE
;	db REFLECT
;	db FOCUS_ENERGY
;	db FLASH_CANNON
;	db DRAGON_DARTS
;	db SCALD
;	db SELFDESTRUCT
;	db COTTON_GUARD
;	db JUMP_KICK
;	db PSYSHOCK
;	db VENOSHOCK
;	db EARTH_POWER
;	db FIRE_BLAST
;	db WATERFALL
;	db ICICLE_CRASH
;	db SWIFT
;	db MIRROR_MOVE
;	db ROCK_WRECKER
;	db WORK_UP_GROWTH
;	db AMNESIA
;	db ROOST
;	db SOFTBOILED_MILK_DRINK_RECOVER
;	db HI_JUMP_KICK
;	db FIERY_DANCE
;	db DREAM_EATER
;	db POISON_JAB
;	db BULLET_PUNCH
;	db LEECH_LIFE
;	db DOUBLE_HIT
;	db BRAVE_BIRD
;	db TRANSFORM_SKETCH_MIMIC_SPLASH_METRO
;	db TOXIC_SPIKES
;	db POISON_FANG
;	db SPORE
;	db UNUSED
;	db LOCK_ON_MIND_READER
;	db CLEAR_SMOG
;	db DRAGON_DANCE
;	db OMINOUS_WIND
;	db EXPLOSION
;	db MULTI_MOVE_FURY_COMET_BARRAGE_SLAP_CANNON
;	db BONEMERANG
;	db REST
;	db ROCK_SLIDE
;	db HORN_LEECH
;	db BULK_UP
;	db CONVERSION
;	db TRI_ATTACK
;	db SHARPEN_HOWL_MEDITATE
;	db SLASH
;	db SUBSTITUTE
;	db GIGA_IMPACT
;	db TWIN_BEAM
;	db DRAIN_PUNCH
;	db ACROBATICS
;	db WILL_O_WISP
;	db ZEN_HEADBUTT
;	db BRICK_BREAK
;	db FLAME_BURST
;	db HYPER_VOICE
;	db CURSE
;	db GYRO_BALL
;	db ENERGY_BALL
;	db PSYSHIELD_BASH
;	db GUNK_SHOT
;	db REVERSAL
;	db SLUDGE
;	db ICE_SHARD
;	db PROTECT
;	db MACH_PUNCH
;	db SCARY_FACE_COTTON_SPORE_STRING_SHOT
;	db FEINT_ATTACK
;	db DIVE
;	db BELLY_DRUM
;	db SLUDGE_BOMB
;	db MUD_SLAP
;	db SHELL_SMASH
;	db SPIKES
;	db ZAP_CANNON
;	db FORESIGHT_ODOR_SLEUTH_MIRACLE_EYE
;	db DESTINY_BOND
;	db PERISH_SONG
;	db ICY_WIND
;	db POWER_GEM
;	db WILD_CHARGE
;	db PETAL_BLIZZARD
;	db OUTRAGE
;	db SANDSTORM
;	db GIGA_DRAIN
;	db ENDURE
;	db CHARM_FEATHER_DANCE
;	db ROLLOUT
;	db FALSE_SWIPE
;	db SWAGGER
;	db TWISTER
;	db SPARK
;	db ELECTRO_BALL
;	db STEEL_WING
;	db MEAN_LOOK_BLOCK_SPIDER_WEB
;	db ATTRACT
;	db SNORE
;	db HEAL_BELL
;	db RETURN
;	db QUIVER_DANCE
;	db BUG_BUZZ
;	db SAFEGUARD
;	db FURY_CUTTER
;	db FAKE_OUT
;	db MAGNITUDE
;	db DYNAMICPUNCH
;	db MEGAHORN
;	db DRAGONBREATH
;	db BATON_PASS
;	db ENCORE
;	db PURSUIT
;	db RAPID_SPIN
;	db SHADOW_CLAW
;	db IRON_TAIL
;	db METAL_CLAW
;	db AURA_SPHERE
;	db SYNTHESIS_MOONLIGHT_MORNING_SUN
;	db HURRICANE
;	db KNOCK_OFF
;	db SUPERPOWER
;	db CROSS_CHOP
;	db AQUA_JET
;	db RAIN_DANCE
;	db SUNNY_DAY
;	db CRUNCH
;	db DOUBLE_KICK
;	db NASTY_PLOT
;	db EXTREMESPEED
;	db ANCIENTPOWER
;	db SHADOW_BALL
;	db FUTURE_SIGHT
;	db ROCK_SMASH
;	db EGG_BOMB
;	db DARK_PULSE
;	db MOONBLAST
;	db PLAY_ROUGH
;	db CONVERSION2
	db 0

DisplayUsedMoveText:
	;jr .do_it ; comment this out for testing all move animations
	ld a, BATTLE_VARS_MOVE
	call GetBattleVarAddr
	ld de, MoveTable
.loop
	ld a, [de]
	inc de
	and a
	ret z
	ld [hl], a
	push hl
	push de
	farcall UpdateMoveData
	call .do_it
	farcall AnimateCurrentMove
	pop de
	pop hl
	jr .loop

.do_it
; battle command 03

	ld a, [hBattleTurn]
	and a
	jr nz, .start

	ld a, [wPlayerMoveStruct + MOVE_ANIM]
	call UpdateUsedMoves

.start
	ld a, BATTLE_VARS_LAST_MOVE
	call GetBattleVarAddr
	ld d, h
	ld e, l

	ld a, BATTLE_VARS_LAST_COUNTER_MOVE
	call GetBattleVarAddr

	ld a, BATTLE_VARS_MOVE_ANIM
	call GetBattleVar
	ld [wd265], a

	push hl
	farcall CheckUserIsCharging
	pop hl
	jr nz, .charging

	; update last move
	ld a, [wd265]
	ld [hl], a
	ld [de], a

.charging
	; check obedience
	ld hl, UsedMoveText
	ld a, [wAlreadyDisobeyed]
	and a
	jr z, .ok
	ld hl, UsedMoveInsteadText
.ok
	call StdBattleTextBox
	jp ApplyTilemapInVBlank
; 105db9


UpdateUsedMoves: ; 105ed0
; append move a to wPlayerUsedMoves unless it has already been used

	push bc
; start of list
	ld hl, wPlayerUsedMoves
; get move id
	ld b, a
; next count
	ld c, NUM_MOVES

.loop
; get move from the list
	ld a, [hli]
; not used yet?
	and a
	jr z, .add
; already used?
	cp b
	jr z, .quit
; next byte
	dec c
	jr nz, .loop

; if the list is full and the move hasn't already been used
; shift the list back one byte, deleting the first move used
; this can occur with struggle or a new learned move
	ld hl, wPlayerUsedMoves + 1
; 1 = 2
	ld a, [hld]
	ld [hli], a
; 2 = 3
	inc hl
	ld a, [hld]
	ld [hli], a
; 3 = 4
	inc hl
	ld a, [hld]
	ld [hl], a
; 4 = new move
	ld a, b
	ld [wPlayerUsedMoves + 3], a
	jr .quit

.add
; go back to the byte we just inced from
	dec hl
; add the new move
	ld [hl], b

.quit
; list updated
	pop bc
	ret
; 105ef6
